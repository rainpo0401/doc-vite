import{_ as e,c as a,o as t,a4 as n}from"./chunks/framework.DpC1ZpOZ.js";const h=JSON.parse('{"title":"ACN_SparseCtrlMergedLoaderAdvanced","description":"","frontmatter":{},"headers":[],"relativePath":"comfyui/ACN/ACN_SparseCtrlMergedLoaderAdvanced.md","filePath":"comfyui/ACN/ACN_SparseCtrlMergedLoaderAdvanced.md"}'),s={name:"comfyui/ACN/ACN_SparseCtrlMergedLoaderAdvanced.md"},l=n(`<h1 id="acn-sparsectrlmergedloaderadvanced" tabindex="-1">ACN_SparseCtrlMergedLoaderAdvanced <a class="header-anchor" href="#acn-sparsectrlmergedloaderadvanced" aria-label="Permalink to &quot;ACN_SparseCtrlMergedLoaderAdvanced&quot;">â€‹</a></h1><ul><li>Class name: SparseCtrlMergedLoaderAdvanced</li><li>Category: Adv-ControlNet ğŸ›‚ğŸ…ğŸ…’ğŸ…/SparseCtrl/experimental</li><li>Output node: False</li><li>Repo Ref: <a href="https://github.com/Kosinkadink/ComfyUI-Advanced-ControlNet.git" target="_blank" rel="noreferrer">https://github.com/Kosinkadink/ComfyUI-Advanced-ControlNet.git</a></li></ul><p>SparseCtrlMergedLoaderAdvanced èŠ‚ç‚¹æ—¨åœ¨é«˜æ•ˆç®¡ç†å’ŒåŠ è½½å…·æœ‰ç¨€ç–æ§åˆ¶ç‰¹æ€§çš„é«˜çº§æ§åˆ¶ç½‘ç»œã€‚å®ƒå°†è¿åŠ¨ç‰¹æ€§é›†æˆåˆ°æ§åˆ¶ç½‘ç»œä¸­ï¼Œå…è®¸åŸºäºè¿åŠ¨å¼ºåº¦å’Œè§„æ¨¡å‚æ•°è¿›è¡ŒåŠ¨æ€å’Œè‡ªé€‚åº”æ§åˆ¶ã€‚æ­¤èŠ‚ç‚¹å¯¹äºéœ€è¦å¯¹å¤æ‚ç³»ç»Ÿè¿›è¡Œç²¾ç»†æ§åˆ¶çš„åº”ç”¨è‡³å…³é‡è¦ï¼Œç¡®ä¿äº†è¿åŠ¨å’Œæ§åˆ¶çš„æ— ç¼èåˆï¼Œä»¥æé«˜æ€§èƒ½ã€‚</p><h1 id="input-types" tabindex="-1">Input types <a class="header-anchor" href="#input-types" aria-label="Permalink to &quot;Input types&quot;">â€‹</a></h1><h2 id="required" tabindex="-1">Required <a class="header-anchor" href="#required" aria-label="Permalink to &quot;Required&quot;">â€‹</a></h2><ul><li>sparsectrl_name <ul><li>å‚æ•° &#39;sparsectrl_name&#39; æŒ‡å®šè¦åŠ è½½çš„ç¨€ç–æ§åˆ¶æ¨¡å‹çš„åç§°ï¼Œè¿™å¯¹äºè¯†åˆ«å’Œè®¿é—®æ­£ç¡®çš„æ§åˆ¶è®¾ç½®è‡³å…³é‡è¦ã€‚æ­¤å‚æ•°å¯¹èŠ‚ç‚¹çš„æ“ä½œè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒç›´æ¥å½±å“åº”ç”¨çš„æ§åˆ¶èƒ½åŠ›ã€‚</li><li>Comfy dtype: str</li><li>Python dtype: str</li></ul></li><li>control_net_name <ul><li>å‚æ•° &#39;control_net_name&#39; ç”¨äºå®šä¹‰æ§åˆ¶ç½‘ç»œæ¨¡å‹çš„åç§°ã€‚å®ƒåœ¨èŠ‚ç‚¹çš„åŠŸèƒ½ä¸­æ‰®æ¼”é‡è¦è§’è‰²ï¼Œå› ä¸ºå®ƒå†³å®šäº†è¦ä½¿ç”¨çš„ç‰¹å®šæ§åˆ¶ç½‘ç»œï¼Œå½±å“æ•´ä½“çš„æ§åˆ¶ç­–ç•¥ã€‚</li><li>Comfy dtype: str</li><li>Python dtype: str</li></ul></li><li>use_motion <ul><li>å‚æ•° &#39;use_motion&#39; æŒ‡ç¤ºæ˜¯å¦åº”å°†è¿åŠ¨ç‰¹æ€§çº³å…¥æ§åˆ¶ç½‘ç»œã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦å‚æ•°ï¼Œå› ä¸ºå®ƒå¯ç”¨æˆ–ç¦ç”¨äº†åŸºäºè¿åŠ¨çš„æ§åˆ¶çš„åŠ¨æ€é€‚åº”ï¼Œå¯¼è‡´ä¸åŒçš„æ§åˆ¶è¡Œä¸ºã€‚</li><li>Comfy dtype: bool</li><li>Python dtype: bool</li></ul></li><li>motion_strength <ul><li>å‚æ•° &#39;motion_strength&#39; è°ƒæ•´æ§åˆ¶ç½‘ç»œå†…è¿åŠ¨æ•ˆæœçš„å¼ºåº¦ã€‚è¿™æ˜¯ä¸€ä¸ªå…³é”®å‚æ•°ï¼Œå…è®¸ç”¨æˆ·å¾®è°ƒè¿åŠ¨å¯¹æ§åˆ¶ç»“æœçš„å½±å“ï¼Œä»è€Œå®šåˆ¶æ§åˆ¶å“åº”ã€‚</li><li>Comfy dtype: float</li><li>Python dtype: float</li></ul></li><li>motion_scale <ul><li>å‚æ•° &#39;motion_scale&#39; å®šä¹‰åº”ç”¨äºæ§åˆ¶ç½‘ç»œçš„è¿åŠ¨æ•ˆæœçš„è§„æ¨¡ã€‚å®ƒæ˜¯ä¸€ä¸ªæœ‰å½±å“åŠ›çš„å‚æ•°ï¼Œä¿®æ”¹äº†è¿åŠ¨æ•´åˆçš„èŒƒå›´ï¼Œå½±å“äº†æ•´ä½“æ§åˆ¶åŠ¨æ€ã€‚</li><li>Comfy dtype: float</li><li>Python dtype: float</li></ul></li></ul><h2 id="optional" tabindex="-1">Optional <a class="header-anchor" href="#optional" aria-label="Permalink to &quot;Optional&quot;">â€‹</a></h2><ul><li>sparse_method <ul><li>å‚æ•° &#39;sparse_method&#39; é€‰æ‹©æ§åˆ¶ç½‘ç»œå†…å¤„ç†ç¨€ç–æ•°æ®çš„æ–¹æ³•ã€‚è™½ç„¶å®ƒæ˜¯å¯é€‰çš„ï¼Œä½†å®ƒå¯ä»¥æ˜¾è‘—å½±å“ç¨€ç–æ•°æ®çš„å¤„ç†æ–¹å¼ï¼Œå¯èƒ½æ”¹å˜èŠ‚ç‚¹çš„æ€§èƒ½ã€‚</li><li>Comfy dtype: SPARSE_METHOD</li><li>Python dtype: SparseMethod</li></ul></li><li>tk_optional <ul><li>æä¾›çš„ &#39;tk_optional&#39; å‚æ•°å¯ä»¥æä¾›æ§åˆ¶ç½‘ç»œä¸­æ—¶é—´æ­¥å…³é”®å¸§çš„é¢å¤–æ§åˆ¶ã€‚è¿™ä¸ªå¯é€‰å‚æ•°å¯ä»¥ç”¨æ¥æŒ‡å®šç‰¹å®šçš„å…³é”®å¸§ï¼Œä»¥å®ç°æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚</li><li>Comfy dtype: TIMESTEP_KEYFRAME</li><li>Python dtype: TimestepKeyframeGroup</li></ul></li></ul><h1 id="output-types" tabindex="-1">Output types <a class="header-anchor" href="#output-types" aria-label="Permalink to &quot;Output types&quot;">â€‹</a></h1><ul><li>CONTROL_NET <ul><li>è¾“å‡º &#39;CONTROL_NET&#39; è¡¨ç¤ºå·²åŠ è½½çš„å…·æœ‰é›†æˆè¿åŠ¨ç‰¹æ€§çš„æ§åˆ¶ç½‘ç»œã€‚å®ƒæ˜¯ä¸€ä¸ªå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå°è£…äº†æ§åˆ¶è®¾ç½®å’Œè¿åŠ¨å‚æ•°ï¼Œå‡†å¤‡åœ¨æ›´é«˜çº§åˆ«çš„æ§åˆ¶ç³»ç»Ÿä¸­åº”ç”¨ã€‚</li><li>Comfy dtype: CONTROL_NET</li><li>Python dtype: ControlNetAdvanced</li></ul></li></ul><h1 id="usage-tips" tabindex="-1">Usage tips <a class="header-anchor" href="#usage-tips" aria-label="Permalink to &quot;Usage tips&quot;">â€‹</a></h1><ul><li>Infra type: GPU</li></ul><h1 id="source-code" tabindex="-1">Source code <a class="header-anchor" href="#source-code" aria-label="Permalink to &quot;Source code&quot;">â€‹</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>class SparseCtrlMergedLoaderAdvanced:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @classmethod</span></span>
<span class="line"><span>    def INPUT_TYPES(s):</span></span>
<span class="line"><span>        return {&#39;required&#39;: {&#39;sparsectrl_name&#39;: (folder_paths.get_filename_list(&#39;controlnet&#39;),), &#39;control_net_name&#39;: (folder_paths.get_filename_list(&#39;controlnet&#39;),), &#39;use_motion&#39;: (&#39;BOOLEAN&#39;, {&#39;default&#39;: True}), &#39;motion_strength&#39;: (&#39;FLOAT&#39;, {&#39;default&#39;: 1.0, &#39;min&#39;: 0.0, &#39;max&#39;: 10.0, &#39;step&#39;: 0.001}), &#39;motion_scale&#39;: (&#39;FLOAT&#39;, {&#39;default&#39;: 1.0, &#39;min&#39;: 0.0, &#39;max&#39;: 10.0, &#39;step&#39;: 0.001})}, &#39;optional&#39;: {&#39;sparse_method&#39;: (&#39;SPARSE_METHOD&#39;,), &#39;tk_optional&#39;: (&#39;TIMESTEP_KEYFRAME&#39;,)}}</span></span>
<span class="line"><span>    RETURN_TYPES = (&#39;CONTROL_NET&#39;,)</span></span>
<span class="line"><span>    FUNCTION = &#39;load_controlnet&#39;</span></span>
<span class="line"><span>    CATEGORY = &#39;Adv-ControlNet ğŸ›‚ğŸ…ğŸ…’ğŸ…/SparseCtrl/experimental&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    def load_controlnet(self, sparsectrl_name: str, control_net_name: str, use_motion: bool, motion_strength: float, motion_scale: float, sparse_method: SparseMethod=SparseSpreadMethod(), tk_optional: TimestepKeyframeGroup=None):</span></span>
<span class="line"><span>        sparsectrl_path = folder_paths.get_full_path(&#39;controlnet&#39;, sparsectrl_name)</span></span>
<span class="line"><span>        controlnet_path = folder_paths.get_full_path(&#39;controlnet&#39;, control_net_name)</span></span>
<span class="line"><span>        sparse_settings = SparseSettings(sparse_method=sparse_method, use_motion=use_motion, motion_strength=motion_strength, motion_scale=motion_scale, merged=True)</span></span>
<span class="line"><span>        controlnet = load_controlnet(controlnet_path, timestep_keyframe=tk_optional)</span></span>
<span class="line"><span>        if controlnet is None or type(controlnet) != ControlNetAdvanced:</span></span>
<span class="line"><span>            raise ValueError(f&#39;controlnet_path must point to a normal ControlNet, but instead: {type(controlnet).__name__}&#39;)</span></span>
<span class="line"><span>        sparsectrl = load_sparsectrl(sparsectrl_path, timestep_keyframe=tk_optional, sparse_settings=SparseSettings.default())</span></span>
<span class="line"><span>        new_state_dict = controlnet.control_model.state_dict()</span></span>
<span class="line"><span>        for (key, value) in sparsectrl.control_model.motion_holder.motion_wrapper.state_dict().items():</span></span>
<span class="line"><span>            new_state_dict[key] = value</span></span>
<span class="line"><span>        sparsectrl = load_sparsectrl(sparsectrl_path, controlnet_data=new_state_dict, timestep_keyframe=tk_optional, sparse_settings=sparse_settings)</span></span>
<span class="line"><span>        return (sparsectrl,)</span></span></code></pre></div>`,14),o=[l];function r(p,i,d,c,_,u){return t(),a("div",null,o)}const f=e(s,[["render",r]]);export{h as __pageData,f as default};
